<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planet Explorer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>🪐 Planet Explorer</h1>

        <nav class="navigation-tabs">
            <button class="nav-tab active" data-tab="explorer">🌍 Explorer</button>
            <button class="nav-tab" data-tab="analytics">📊 Analytics</button>
            <button class="nav-tab" data-tab="3dviewer">🚀 3D Galia Viewer</button>
        </nav>

        <nav class="breadcrumb">
            <a href="../index.html">Home</a> > Planet Explorer
        </nav>
    </header>

    <main>
        <!-- Explorer Tab Content -->
        <div id="explorerTab" class="tab-content active">
            <div class="stats">
                <div class="stat-card">
                    <span class="stat-number" id="totalSystems">0</span>
                    <span class="stat-label">Star Systems</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="totalPlanets">0</span>
                    <span class="stat-label">Planets</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="uniqueResources">0</span>
                    <span class="stat-label">Resource Types</span>
                </div>
            </div>

            <div class="explorer-layout">
                <div class="systems-sidebar">
                    <h3>🌟 Systems</h3>
                    <div class="search-container" id="explorerControls">
                        <input type="text" id="searchInput" placeholder="Search systems, planets, resources...">
                    </div>
                    <div class="checkbox-container" id="systemCheckboxes">
                        <!-- System checkboxes will be populated here -->
                    </div>
                </div>

                <div class="systems-main">
                    <div class="systems-list" id="systemsGrid">
                        <!-- Systems will be populated here -->
                    </div>
                </div>

                <div class="resources-sidebar">
                    <h3>🔗 Resources</h3>
                    <div class="checkbox-container" id="resourceCheckboxes">
                        <!-- Resource checkboxes will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab Content -->
        <div id="analyticsTab" class="tab-content">
            <div class="analytics-header">
                <h2>📊 Resource Analytics</h2>
                <p>Analyze resource distribution and scarcity across the galaxy</p>
            </div>

            <div class="analytics-stats">
                <div class="stat-card">
                    <span class="stat-number" id="scarcestCount">0</span>
                    <span class="stat-label">Ultra Rare Resources</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="averageRichness">0</span>
                    <span class="stat-label">Average Richness</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="topSystemsCount">0</span>
                    <span class="stat-label">Resource-Rich Systems</span>
                </div>
            </div>

            <div class="analytics-sections">
                <div class="analytics-section">
                    <h3>🔥 Scarcest Resources</h3>
                    <p class="section-note">The rarest resources in the galaxy, found in the fewest locations</p>
                    <div id="scarcestResources" class="resource-analysis-grid">
                        <!-- Scarcest resources will be populated here -->
                    </div>
                </div>

                <div class="analytics-section">
                    <h3>💎 Highest Quality Resources</h3>
                    <p class="section-note">Resources with the highest average richness across all deposits</p>
                    <div id="highestQuality" class="resource-analysis-grid">
                        <!-- Highest quality resources will be populated here -->
                    </div>
                </div>

                <div class="analytics-section">
                    <h3>🌟 Top Resource Locations</h3>
                    <p class="section-note">Star systems ranked by number of unique resource types (resource diversity across all planets). Strategic Score is a system rating from your data (meaning not defined here).</p>
                    <div id="topLocations" class="location-analysis-grid">
                        <!-- Top locations will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 3D Galia Viewer Tab Content -->
        <div id="3dviewerTab" class="tab-content">
            <div class="viewer-header">
                <h2>🚀 3D Galia Viewer</h2>
                <p>Interactive 3D view of the galaxy. Drag to rotate, scroll to zoom, double-click systems for details.</p>
                <p style="font-size: 0.9em; color: #888; margin-top: 5px;">💡 Left click + drag to rotate • Right click + drag to move • Mouse wheel to zoom</p>
            </div>

            <!-- 3D Viewer Controls -->
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:15px;margin-bottom:5px;">
                <div style="display:flex;gap:10px;">
                    <button id="centerLastClickedBtn" onclick="window.centerOnLastClickedStar()"
                            style="background:#4CAF50;color:white;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;font-size:12px;display:none;"
                            title="Center camera on last clicked star">
                        🎯 Center on Last Star
                    </button>
                </div>
                <div style="display:flex;gap:10px;">
                    <button onclick="window.toggleFullscreen()"
                            style="background:#2196F3;color:white;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;font-size:12px;"
                            title="Toggle fullscreen">
                        ⛶ Expand
                    </button>
                </div>
            </div>

            <div id="planetMap" style="width:100%;height:600px;background:#000;border-radius:8px;overflow:hidden;"></div>
            <div id="planetTooltip" class="map-tooltip" style="display:none;position:absolute;pointer-events:none;padding:8px;background:rgba(0,0,0,0.7);color:#fff;border-radius:4px;font-size:12px;z-index:1000"></div>

            <!-- System Information Widget -->
            <div id="systemInfoWidget" style="display:none;margin-top:20px;padding:20px;background:#1a1a2e;border-radius:8px;color:#fff;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                    <h3 id="systemInfoTitle" style="margin:0;color:#4CAF50;">System Information</h3>
                    <button onclick="window.restoreAllSystems()" style="background:#ff4444;color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;">✕ Close & Show All Systems</button>
                </div>
                <div id="systemInfoContent">
                    <!-- System information will be populated here -->
                </div>
            </div>
        </div>
    </main>

    <div class="modal" id="planetModal">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <div id="modalContent">
                <!-- Planet details will be shown here -->
            </div>
        </div>
    </div>

    <script src="../Utils/DOMUtils.js"></script>
    <script src="../Utils/BaseAnalytics.js"></script>
    <script src="../Utils/BaseExplorer.js"></script>
    <script src="../Utils/BaseApp.js"></script>
    <script src="../Utils/DataLoader.js"></script>
    <script src="../Data/planet-data.js"></script>
    <script src="explorer.js"></script>
    <script src="analytics.js"></script>
    <script src="app.js"></script>

    <!-- Import map for three.js so example modules can resolve the bare specifier 'three' -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js"
        }
    }
    </script>

    <!-- Load data files -->
    <script src="../Data/buildings-data.js"></script>
    <script src="../Data/resources-data.js"></script>
    <script src="../Data/recipes-data.js"></script>

    <!-- three.js (ES modules) and map script -->
    <script type="module" src="planetMap.js"></script>
</body>
</html>